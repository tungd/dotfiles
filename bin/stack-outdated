#!/usr/bin/env python

import fileinput
import glob
import logging
import os
import sys

logging.basicConfig(stream=sys.stderr)

home = os.getenv('HOME')

build_plans = glob.iglob(f'{home}/.stack/build-plan/lts-*.yaml')
latest_build_plan = next(reversed(sorted(build_plans)))
latest_lts, _ = os.path.splitext(os.path.basename(latest_build_plan))

projects = glob.iglob(f'{home}/Projects/*/stack.yaml')

with fileinput.input(files=projects, inplace=True) as f:
    logging.info(fileinput.filename())
    for line in f:
        if line.startswith('resolver'):
            print(f'resolver: {latest_lts}')
        else:
            print(line, end='')
